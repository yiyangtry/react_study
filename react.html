import React from 'react';
import { Box, Server, Database, Activity, HardDrive, Users } from 'lucide-react';

const ShardBox = ({ type, id, docs, store, isPrimary }) => (
  <div className={`p-3 mb-2 rounded-lg border-2 flex flex-col ${
    isPrimary 
      ? 'bg-blue-50 border-blue-500 shadow-sm' 
      : 'bg-orange-50 border-orange-300 border-dashed'
  }`}>
    <div className="flex justify-between items-center mb-1">
      <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${isPrimary ? 'bg-blue-600 text-white' : 'bg-orange-400 text-white'}`}>
        {isPrimary ? 'P' : 'R'}{id}
      </span>
      <span className="text-[10px] text-gray-500 font-mono">STARTED</span>
    </div>
    <div className="text-xs text-gray-700 font-medium">文档: {(docs / 100000000).toFixed(2)} 亿</div>
    <div className="flex items-center text-[10px] text-gray-500 mt-1">
      <HardDrive size={10} className="mr-1" />
      {store}
    </div>
  </div>
);

const NodeCard = ({ name, ip, shards, totalStore, isHot }) => (
  <div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden flex-1 min-w-[280px]">
    <div className={`p-4 ${isHot ? 'bg-red-50' : 'bg-gray-50'} border-b border-gray-200`}>
      <div className="flex justify-between items-start">
        <div>
          <h3 className="font-bold text-gray-800 flex items-center">
            <Server size={16} className="mr-2 text-gray-600" />
            {name.split('-').slice(-1)}
          </h3>
          <p className="text-sm text-gray-500 font-mono mt-1">{ip}</p>
        </div>
        {isHot && (
          <span className="bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full animate-pulse">
            写入压力高
          </span>
        )}
      </div>
    </div>
    <div className="p-4">
      <div className="text-xs font-semibold text-gray-400 uppercase mb-3 tracking-wider">承载分片</div>
      {shards.map((s, i) => (
        <ShardBox key={i} {...s} />
      ))}
      <div className="mt-4 pt-3 border-t border-gray-100 flex justify-between items-center">
        <span className="text-xs text-gray-500 text-gray-400">总计存储</span>
        <span className="text-sm font-bold text-gray-700">{totalStore} GB</span>
      </div>
    </div>
  </div>
);

const App = () => {
  const data = [
    {
      name: "es-cn-node-0001",
      ip: "172.16.44.28",
      totalStore: "229.5",
      isHot: true,
      shards: [
        { id: 1, type: 'p', docs: 340229580, store: '115gb', isPrimary: true },
        { id: 2, type: 'p', docs: 337601751, store: '114.5gb', isPrimary: true }
      ]
    },
    {
      name: "es-cn-node-0002",
      ip: "172.16.44.19",
      totalStore: "229.3",
      isHot: false,
      shards: [
        { id: 0, type: 'p', docs: 337640291, store: '114gb', isPrimary: true },
        { id: 1, type: 'r', docs: 340229580, store: '115.3gb', isPrimary: false }
      ]
    },
    {
      name: "es-cn-node-0003",
      ip: "172.16.44.27",
      totalStore: "227.9",
      isHot: false,
      shards: [
        { id: 2, type: 'r', docs: 337601751, store: '114.2gb', isPrimary: false },
        { id: 0, type: 'r', docs: 337640290, store: '113.7gb', isPrimary: false }
      ]
    }
  ];

  return (
    <div className="min-h-screen bg-gray-100 p-8 font-sans">
      <div className="max-w-6xl mx-auto">
        <header className="mb-8">
          <h1 className="text-2xl font-extrabold text-gray-900 flex items-center">
            <Activity className="mr-2 text-blue-600" />
            reach_data_channel_subtask_v1 分片分布图
          </h1>
          <p className="text-gray-600 mt-2">集群健康度：<span className="text-green-600 font-bold">GREEN</span> | 共 3 主分片，3 副本分片</p>
        </header>

        <div className="flex flex-wrap gap-6 mb-8">
          {data.map((node, idx) => (
            <NodeCard key={idx} {...node} />
          ))}
        </div>

        <div className="bg-blue-900 text-white rounded-xl p-6 shadow-xl">
          <h2 className="text-lg font-bold mb-4 flex items-center">
            <Database className="mr-2" />
            数据洞察 (Insights)
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="bg-blue-800 p-4 rounded-lg">
              <div className="text-blue-200 text-xs uppercase font-bold mb-1">总文档数</div>
              <div className="text-2xl font-mono">1,015,471,622</div>
              <div className="text-xs text-blue-300 mt-1">约 10.15 亿条记录</div>
            </div>
            <div className="bg-blue-800 p-4 rounded-lg">
              <div className="text-blue-200 text-xs uppercase font-bold mb-1">物理总存储</div>
              <div className="text-2xl font-mono">686.7 GB</div>
              <div className="text-xs text-blue-300 mt-1">含所有主副分片</div>
            </div>
            <div className="bg-blue-800 p-4 rounded-lg">
              <div className="text-blue-200 text-xs uppercase font-bold mb-1">平均分片大小</div>
              <div className="text-2xl font-mono">114.4 GB</div>
              <div className="text-xs text-yellow-300 mt-1">⚠️ 超过建议值 (50GB)</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;